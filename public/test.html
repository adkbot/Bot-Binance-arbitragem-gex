<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Teste Completo do Sistema - Bot Binance</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-card h3 {
            margin-bottom: 15px;
            color: #00ff88;
        }
        
        .test-button {
            background: linear-gradient(45deg, #00ff88, #00c8ff);
            color: #000;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
        }
        
        .test-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .test-results {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .success {
            color: #00ff88;
        }
        
        .error {
            color: #ff4757;
        }
        
        .warning {
            color: #ffa502;
        }
        
        .info {
            color: #70a1ff;
        }
        
        .run-all {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .summary {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Teste Completo do Sistema</h1>
            <p>Diagn√≥stico abrangente do Bot Binance</p>
        </div>
        
        <button class="run-all" onclick="runAllTests()">üöÄ Executar Todos os Testes</button>
        
        <div class="test-grid">
            <div class="test-card">
                <h3>üåê Teste 1: Sistema HTTP</h3>
                <p>Verifica se o sistema b√°sico est√° funcionando</p>
                <button class="test-button" onclick="runTest('system')">Executar Teste</button>
                <div id="system-results" class="test-results" style="display: none;"></div>
            </div>
            
            <div class="test-card">
                <h3>üîó Teste 2: Conectividade</h3>
                <p>Testa conex√£o externa e DNS</p>
                <button class="test-button" onclick="runTest('connectivity')">Executar Teste</button>
                <div id="connectivity-results" class="test-results" style="display: none;"></div>
            </div>
            
            <div class="test-card">
                <h3>üì¶ Teste 3: CCXT e Binance</h3>
                <p>Verifica biblioteca CCXT e conex√£o Binance</p>
                <button class="test-button" onclick="runTest('ccxt')">Executar Teste</button>
                <div id="ccxt-results" class="test-results" style="display: none;"></div>
            </div>
            
            <div class="test-card">
                <h3>üîë Teste 4: Simula√ß√£o de API</h3>
                <p>Testa comportamento com chaves inv√°lidas</p>
                <button class="test-button" onclick="runTest('simulation')">Executar Teste</button>
                <div id="simulation-results" class="test-results" style="display: none;"></div>
            </div>
            
            <div class="test-card">
                <h3>üí∞ Teste 5: Valida√ß√£o Real</h3>
                <p>Testa valida√ß√£o com chaves reais (se fornecidas)</p>
                <input type="text" id="test-api-key" placeholder="API Key (opcional)" style="width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 5px; border: none;">
                <input type="password" id="test-api-secret" placeholder="API Secret (opcional)" style="width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 5px; border: none;">
                <button class="test-button" onclick="runTest('validation')">Executar Teste</button>
                <div id="validation-results" class="test-results" style="display: none;"></div>
            </div>
            
            <div class="test-card">
                <h3>üì° Teste 6: Comunica√ß√£o Frontend</h3>
                <p>Verifica comunica√ß√£o entre frontend e backend</p>
                <button class="test-button" onclick="runTest('frontend')">Executar Teste</button>
                <div id="frontend-results" class="test-results" style="display: none;"></div>
            </div>
        </div>
        
        <div class="summary" id="test-summary" style="display: none;">
            <h3>üìä Resumo dos Testes</h3>
            <div id="summary-content"></div>
        </div>
    </div>
    
    <script>
        let testResults = {};
        
        async function runTest(testType) {
            const button = event.target;
            const resultsDiv = document.getElementById(`${testType}-results`);
            
            button.disabled = true;
            button.textContent = 'Executando...';
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="info">üîÑ Executando teste...</div>';
            
            try {
                let response;
                
                switch(testType) {
                    case 'system':
                        response = await fetch('/api/test-system');
                        break;
                    case 'connectivity':
                        response = await fetch('/api/test-connectivity');
                        break;
                    case 'ccxt':
                        response = await fetch('/api/test-ccxt');
                        break;
                    case 'simulation':
                        response = await fetch('/api/test-api-simulation', { method: 'POST' });
                        break;
                    case 'validation':
                        const apiKey = document.getElementById('test-api-key').value;
                        const apiSecret = document.getElementById('test-api-secret').value;
                        if (!apiKey || !apiSecret) {
                            throw new Error('API Key e Secret s√£o obrigat√≥rios para este teste');
                        }
                        response = await fetch('/api/validate-balance', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ apiKey, apiSecret })
                        });
                        break;
                    case 'frontend':
                        response = await fetch('/api/create-session', { method: 'POST' });
                        break;
                }
                
                const data = await response.json();
                testResults[testType] = { success: response.ok, data };
                
                displayResults(resultsDiv, data, response.ok);
                
            } catch (error) {
                testResults[testType] = { success: false, error: error.message };
                resultsDiv.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
            
            button.disabled = false;
            button.textContent = 'Executar Teste';
            updateSummary();
        }
        
        function displayResults(div, data, success) {
            let html = '';
            
            if (success) {
                html += `<div class="success">‚úÖ ${data.message}</div>`;
                
                if (data.systemInfo) {
                    html += '<div class="info">üìä Informa√ß√µes do Sistema:</div>';
                    Object.entries(data.systemInfo).forEach(([key, value]) => {
                        html += `<div>‚Ä¢ ${key}: ${JSON.stringify(value)}</div>`;
                    });
                }
                
                if (data.tests) {
                    html += '<div class="info">üß™ Resultados dos Testes:</div>';
                    data.tests.forEach(test => {
                        const status = test.success ? '‚úÖ' : '‚ùå';
                        const className = test.success ? 'success' : 'error';
                        html += `<div class="${className}">${status} ${test.test}</div>`;
                        if (test.error) {
                            html += `<div class="error">   Erro: ${test.error}</div>`;
                        }
                        if (test.address) {
                            html += `<div class="info">   IP: ${test.address}</div>`;
                        }
                        if (test.serverTime) {
                            html += `<div class="info">   Tempo: ${test.serverTime}</div>`;
                        }
                        if (test.marketsCount) {
                            html += `<div class="info">   Mercados: ${test.marketsCount}</div>`;
                        }
                    });
                }
                
                if (data.usdtBalance !== undefined) {
                    html += `<div class="success">üí∞ Saldo USDT: ${data.usdtBalance}</div>`;
                    html += `<div class="info">üíµ Total USDT: ${data.totalUSDT}</div>`;
                }
                
            } else {
                html += `<div class="error">‚ùå ${data.error || 'Erro desconhecido'}</div>`;
            }
            
            div.innerHTML = html;
        }
        
        async function runAllTests() {
            const tests = ['system', 'connectivity', 'ccxt', 'simulation', 'frontend'];
            
            for (const test of tests) {
                await new Promise(resolve => {
                    const button = document.querySelector(`[onclick="runTest('${test}')"]`);
                    button.click();
                    setTimeout(resolve, 2000); // Aguardar 2 segundos entre testes
                });
            }
        }
        
        function updateSummary() {
            const summaryDiv = document.getElementById('test-summary');
            const contentDiv = document.getElementById('summary-content');
            
            if (Object.keys(testResults).length === 0) return;
            
            summaryDiv.style.display = 'block';
            
            let html = '';
            let totalTests = 0;
            let passedTests = 0;
            
            Object.entries(testResults).forEach(([test, result]) => {
                totalTests++;
                if (result.success) passedTests++;
                
                const status = result.success ? '‚úÖ' : '‚ùå';
                const className = result.success ? 'success' : 'error';
                html += `<div class="${className}">${status} ${test.toUpperCase()}</div>`;
            });
            
            html = `<div class="info">üìà Progresso: ${passedTests}/${totalTests} testes passaram</div>` + html;
            
            contentDiv.innerHTML = html;
        }
    </script>
</body>
</html>